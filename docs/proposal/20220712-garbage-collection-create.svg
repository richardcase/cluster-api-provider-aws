<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="530px" preserveAspectRatio="none" style="width:838px;height:530px;background:#FFFFFF;" version="1.1" viewBox="0 0 838 530" width="838px" zoomAndPan="magnify"><defs/><g><rect fill="#FFFFFF" height="290.1953" style="stroke:#181818;stroke-width:1.0;" width="10" x="333" y="141.5625"/><rect height="88.3984" style="stroke:#000000;stroke-width:1.5;fill:none;" width="407.5" x="252.5" y="198.6953"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="24" x2="24" y1="81.2969" y2="449.7578"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="159.5" x2="159.5" y1="81.2969" y2="449.7578"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="337.5" x2="337.5" y1="81.2969" y2="449.7578"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="531.5" x2="531.5" y1="81.2969" y2="449.7578"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="654.5" x2="654.5" y1="81.2969" y2="449.7578"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="811.5" x2="811.5" y1="81.2969" y2="449.7578"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="32" x="5" y="77.9951">User</text><ellipse cx="24" cy="13.5" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M24,21.5 L24,48.5 M11,29.5 L37,29.5 M24,48.5 L11,63.5 M24,48.5 L37,63.5 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="32" x="5" y="461.7529">User</text><ellipse cx="24" cy="473.5547" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M24,481.5547 L24,508.5547 M11,489.5547 L37,489.5547 M24,508.5547 L11,523.5547 M24,508.5547 L37,523.5547 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="65" x="124.5" y="77.9951">APIServer</text><path d="M142,29 C142,19 160,19 160,19 C160,19 178,19 178,29 L178,55 C178,65 160,65 160,65 C160,65 142,65 142,55 L142,29 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M142,29 C142,39 160,39 160,39 C160,39 178,39 178,29 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="65" x="124.5" y="461.7529">APIServer</text><path d="M142,475.0547 C142,465.0547 160,465.0547 160,465.0547 C160,465.0547 178,465.0547 178,475.0547 L178,501.0547 C178,511.0547 160,511.0547 160,511.0547 C160,511.0547 142,511.0547 142,501.0547 L142,475.0547 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M142,475.0547 C142,485.0547 160,485.0547 160,485.0547 C160,485.0547 178,485.0547 178,475.0547 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="145" x="262.5" y="77.9951">InfraClusterController</text><ellipse cx="338" cy="49" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/><polygon fill="#181818" points="334,37,340,32,338,37,340,42,334,37" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="145" x="262.5" y="461.7529">InfraClusterController</text><ellipse cx="338" cy="481.0547" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/><polygon fill="#181818" points="334,469.0547,340,464.0547,338,469.0547,340,474.0547,334,469.0547" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="87" x="488.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="73" x="495.5" y="69.9951">gc_service</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="87" x="488.5" y="448.7578"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="73" x="495.5" y="468.7529">gc_service</text><rect fill="#E2E2F0" height="30.2969" style="stroke:#181818;stroke-width:0.5;" width="115" x="599.5" y="46"/><rect fill="#E2E2F0" height="30.2969" style="stroke:#181818;stroke-width:0.5;" width="115" x="595.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="101" x="602.5" y="69.9951">other_services</text><rect fill="#E2E2F0" height="30.2969" style="stroke:#181818;stroke-width:0.5;" width="115" x="599.5" y="448.7578"/><rect fill="#E2E2F0" height="30.2969" style="stroke:#181818;stroke-width:0.5;" width="115" x="595.5" y="452.7578"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="101" x="602.5" y="472.7529">other_services</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="41" x="791.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="27" x="798.5" y="69.9951">aws</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="41" x="791.5" y="448.7578"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="27" x="798.5" y="468.7529">aws</text><rect fill="#FFFFFF" height="290.1953" style="stroke:#181818;stroke-width:1.0;" width="10" x="333" y="141.5625"/><polygon fill="#181818" points="148,108.4297,158,112.4297,148,116.4297,152,112.4297" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="24" x2="154" y1="112.4297" y2="112.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="31" y="107.3638">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99" x="44" y="107.3638">apply capi yaml</text><polygon fill="#181818" points="171,137.5625,161,141.5625,171,145.5625,167,141.5625" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="165" x2="332" y1="141.5625" y2="141.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="177" y="136.4966">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141" x="190" y="136.4966">watch (create/update)</text><line style="stroke:#181818;stroke-width:1.0;" x1="343" x2="385" y1="170.6953" y2="170.6953"/><line style="stroke:#181818;stroke-width:1.0;" x1="385" x2="385" y1="170.6953" y2="183.6953"/><line style="stroke:#181818;stroke-width:1.0;" x1="344" x2="385" y1="183.6953" y2="183.6953"/><polygon fill="#181818" points="354,179.6953,344,183.6953,354,187.6953,350,183.6953" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="350" y="165.6294">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="363" y="165.6294">Add infra cluster finalizer</text><path d="M252.5,198.6953 L322.5,198.6953 L322.5,205.8281 L312.5,215.8281 L252.5,215.8281 L252.5,198.6953 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="88.3984" style="stroke:#000000;stroke-width:1.5;" width="407.5" x="252.5" y="198.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="25" x="267.5" y="211.7622">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="145" x="337.5" y="210.9058">[if gc feature enabled]</text><polygon fill="#181818" points="520,232.9609,530,236.9609,520,240.9609,524,236.9609" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="343" x2="526" y1="236.9609" y2="236.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="350" y="231.895">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="60" x="363" y="231.895">Reconcile</text><line style="stroke:#181818;stroke-width:1.0;" x1="532" x2="574" y1="266.0938" y2="266.0938"/><line style="stroke:#181818;stroke-width:1.0;" x1="574" x2="574" y1="266.0938" y2="279.0938"/><line style="stroke:#181818;stroke-width:1.0;" x1="533" x2="574" y1="279.0938" y2="279.0938"/><polygon fill="#181818" points="543,275.0938,533,279.0938,543,283.0938,539,279.0938" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="539" y="261.0278">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96" x="552" y="261.0278">add gc finalizer</text><polygon fill="#181818" points="171,311.2266,161,315.2266,171,319.2266,167,315.2266" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="165" x2="332" y1="315.2266" y2="315.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="177" y="310.1606">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="111" x="190" y="310.1606">patch infracluster</text><polygon fill="#181818" points="643,340.3594,653,344.3594,643,348.3594,647,344.3594" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="343" x2="649" y1="344.3594" y2="344.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="350" y="339.2935">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="60" x="363" y="339.2935">Reconcile</text><polygon fill="#181818" points="800,369.4922,810,373.4922,800,377.4922,804,373.4922" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="655" x2="806" y1="373.4922" y2="373.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="662" y="368.4263">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120" x="675" y="368.4263">create cluster infra</text><polygon fill="#181818" points="354,398.625,344,402.625,354,406.625,350,402.625" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="348" x2="654" y1="402.625" y2="402.625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="360" y="397.5591">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89" x="373" y="397.5591">update status</text><polygon fill="#181818" points="171,427.7578,161,431.7578,171,435.7578,167,431.7578" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="165" x2="337" y1="431.7578" y2="431.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="177" y="426.6919">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="36" x="199" y="426.6919">patch</text><!--MD5=[403a22a139837a6bda32413531192b02]
@startuml
autonumber
actor User
database APIServer
control InfraClusterController
participant gc_service
collections other_services
participant aws
User -> APIServer: apply capi yaml
InfraClusterController -> APIServer: watch (create/update)
activate InfraClusterController
InfraClusterController -> InfraClusterController: Add infra cluster finalizer
opt if gc feature enabled
    InfraClusterController -> gc_service: Reconcile
    gc_service -> gc_service: add gc finalizer
end
InfraClusterController -> APIServer: patch infracluster
InfraClusterController -> other_services: Reconcile
other_services -> aws: create cluster infra
other_services -> InfraClusterController: update status
InfraClusterController -> APIServer: patch
deactivate InfraClusterController
@enduml

PlantUML version 1.2022.5(Sat Apr 30 11:55:52 BST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: GB
--></g></svg>